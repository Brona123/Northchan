<template name="beforeSection">
  {{#if isDesktop}}
    {{> section}}
  {{/if}}

  {{#if isPhone}}
    {{> section}}
  {{/if}}

  {{#if isTablet}}
    {{> section}}
  {{/if}}
</template>

<template name="section">
  <div class="col-xs-12">
    <!--<h1 class="text-center"> {{name}} </h1>-->
    <button class="glyphicon glyphicon-minus" id="toggleCreateThreadForm"></button>
    <form id="createThread">
      <input type="hidden" name="sectionId" value="{{_id}}" />
        <input type="text" name="threadName" class="form-control" placeholder="Thread name" maxlength="80" />
      
      <select id="inputTypeSelection" class="form-control">
        <option value="embed">Embed (youtube/vimeo/twitch VoD)</option>
        <option value="file">File (10 MB limit)</option>
        <option value="livestream">Live stream (twitch.tv)</option>
        <option value="poll">Poll</option>
      </select>

      <!-- TODO UI kuntoon -->
      {{> Template.dynamic template=selectedInput }}


      <textarea class="form-control" 
                name="threadInitText" 
                placeholder="Initial text"
                rows="6"></textarea>
      
      <input type="submit" class="btn btn-success btn-block center" value="Create a thread" />
    </form>
    

    <div id="sectionViewCount" class="col-xs-12 glyphicon glyphicon-user">{{sectionViewCount}}</div>
    <br />

    <div id="threadList">
    {{#each threads}}


      <a href="{{../name}}/{{name}}">
      
        <div class="threadContainer {{pageTheme.thread}} col-md-2 col-xs-6">
          {{#if isInRole 'superadmin,moderator'}}
            <button class="btn-danger"
                    name="deleteThread"
                    data-thread-id="{{_id}}">Delete thread</button>
          {{/if}}
          <span class="header">{{truncateHeader name}}</span>
          <hr />
          <span class="glyphicon glyphicon-user"> {{currentlyViewing.length}} </span>

          {{#with downloadUrl}}
            <img src="{{this}}">
          {{/with}}

          {{#with embedLink}}
            <div class="embed">
              <iframe src="{{this}}"
                      frameborder="0" 
                      allowfullscreen>
              </iframe>
            </div>
          {{/with}}
          
          {{#with pollId}}
            <div class="poll">
              <h4>{{pollTitle this}}</h4>
              <canvas id="{{this}}" ></canvas>
            </div>
            {{{pollHtml this}}}
          {{/with}}

          {{#with livestream}}
            <div class="livestream">
              <iframe src="https://player.twitch.tv/?channel={{this}}&autoplay=false"
                      frameborder="0"></iframe>
            </div>
          {{/with}}

          <p>{{firstLines initialText}}</p>
        </div>
      </a>
    {{/each}}
    </div>
  </div>  
</template>

<template name="embed">
  <input type='text' 
          name='embedLink' 
          class='form-control' 
          placeholder='Embed link' />
</template>

<template name="file">
  <div class='input-group'>
    <span class='input-group-btn'>
      <span class='btn btn-primary btn-file'>
        Select file <input type='file' name='initialFile' />
      </span>
    </span>

    <input id='filePath' type='text' class='form-control' readonly>
  </div>
</template>

<template name="livestream">
  <input type="text"
          name="channelName"
          class="form-control"
          placeholder="Channel name" />

  <label class="checkbox-inline"><input type="checkbox" name="includeChat" checked>Include chat</label>
</template>

<template name="poll">
  <div id='pollInput'>
    <input type='text' name='pollTitle' placeholder='Title' />
    <br />Options <input type='button' name='addOption' value='Add option' />
  </div>
</template>